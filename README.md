# Restaurant Scraper - 飲食店営業リスト作成アプリ

食べログから飲食店情報を収集してExcelファイルに出力するPythonスクレイパー（リファクタリング版）

## 🎯 機能

- **食べログスクレイピング**: 店名・電話番号・住所・ジャンル・最寄り駅・営業時間を取得
- **高速非同期処理**: 最大50同時接続で10倍速の処理速度を実現
- **ホットペッパーAPI**: 公式APIを使用した高速・安全なデータ取得
- **データ統合**: 重複除去・データ品質チェック・正規化
- **Excel出力**: 見やすいフォーマットでの営業リスト作成
- **対話モード**: 非エンジニア向けの簡単操作
- **進捗の永続化**: 中断から再開可能な堅牢な設計
- **エラーハンドリング**: 自動リトライとエラー統計

## 📋 必要な環境

- Python 3.8以上
- インターネット接続
- ホットペッパーAPIキー（オプション）

## 🚀 インストール

### 1. ファイルのダウンロード

以下のファイルを同じフォルダに保存してください：

```
restaurant_scraper_app.py
hotpepper_api_client.py
tabelog_scraper_improved.py
restaurant_data_integrator.py
requirements.txt
setup.py
README.md
```

### 2. セットアップ実行

```bash
python setup.py
```

## 💡 使用方法

### 対話モード（推奨）

```bash
python restaurant_scraper_app.py -i
```

画面の指示に従って以下を設定：
- 対象地域の選択
- 取得件数の設定
- データソースの選択
- 出力ファイル名

### コマンドライン

```bash
# 食べログのみで東京都の飲食店50件を取得
python restaurant_scraper_app.py --areas 東京都 --max-per-area 50

# 複数地域で取得
python restaurant_scraper_app.py --areas 東京都 大阪府 神奈川県 --max-per-area 100

# ホットペッパーAPIも使用（APIキーが必要）
python restaurant_scraper_app.py --areas 東京都 --hotpepper-key YOUR_API_KEY

# 出力ファイル名を指定
python restaurant_scraper_app.py --areas 東京都 --output my_restaurant_list.xlsx
```

### 高速版の使用（大量データ取得時）

```bash
# 1000件の大量データを高速取得
python restaurant_scraper_app_fast_v2.py --areas 東京都 --max-per-area 1000

# 環境変数で詳細設定
MAX_CONCURRENT=100 TIMEOUT=120 python restaurant_scraper_app_fast_v2.py --areas 東京都 --max-per-area 5000
```

## 🔑 ホットペッパーAPIキーの取得

1. [リクルートWEBサービス](https://webservice.recruit.co.jp/)にアクセス
2. 無料会員登録
3. ホットペッパーグルメサーチAPIのAPIキーを取得

## 📊 出力ファイル

### Excelファイル構成

**飲食店リストシート**
- No: 連番
- 店名: 店舗名
- 電話番号: 連絡先電話番号
- 住所: 店舗住所
- ジャンル: 料理ジャンル
- 最寄り駅: アクセス情報
- 営業時間: 営業時間・定休日
- データソース: 食べログ/ホットペッパー
- URL: 店舗詳細ページURL
- 調査日: データ取得日

**サマリーシート**
- 総件数
- 電話番号あり件数
- 住所あり件数
- データソース別件数
- 作成日時

## 🎛️ オプション

```bash
--areas AREAS [AREAS ...]     # 対象地域（複数指定可）
--max-per-area MAX_PER_AREA   # 地域あたりの最大取得件数
--output OUTPUT, -o OUTPUT    # 出力ファイル名
--hotpepper-key HOTPEPPER_KEY # ホットペッパーAPIキー
--no-tabelog                  # 食べログを使用しない
--interactive, -i             # 対話モードで実行
--help, -h                    # ヘルプ表示
```

## 🌍 対応地域

- 東京都
- 大阪府
- 神奈川県
- 愛知県
- 福岡県
- 北海道
- 京都府
- 兵庫県
- 埼玉県
- 千葉県

## ⚠️ 注意事項

### 利用規約の遵守

- **食べログ**: 過度なアクセスを避け、サーバーに負荷をかけないよう配慮
- **ホットペッパー**: 公式APIの利用規約に従って使用
- **商用利用**: 各サービスの利用規約を確認してください

### レート制限

- 食べログ: 2-4秒間隔でアクセス
- ホットペッパー: API制限に準拠

### データ品質

- 店舗情報は取得時点のものです
- 営業時間や電話番号は変更される可能性があります
- 営業前に最新情報を確認することをお勧めします

## 🔧 トラブルシューティング

### よくある問題

**1. パッケージインストールエラー**
```bash
pip install --upgrade pip
python setup.py
```

**2. 食べログからデータが取得できない**
- インターネット接続を確認
- しばらく時間をおいて再実行

**3. ホットペッパーAPIエラー**
- APIキーが正しいか確認
- API利用制限に達していないか確認

**4. Excelファイルが開けない**
- ファイルが他のアプリで開かれていないか確認
- 十分な空き容量があるか確認

### ログファイル

実行時のログは `restaurant_scraper.log` に保存されます。
エラーが発生した場合は、このファイルを確認してください。

## 📈 パフォーマンス

### 取得速度の目安

- 食べログ: 約3-5秒/件
- ホットペッパー: 約0.1秒/件（API）

### 推奨設定

- 小規模テスト: 10-50件/地域
- 本格運用: 100-500件/地域
- 大規模調査: 1000件以上/地域

## 🤝 サポート

### 技術的な質問

1. ログファイル（restaurant_scraper.log）を確認
2. エラーメッセージを記録
3. 実行環境（OS、Pythonバージョン）を確認

### 機能改善要望

- 新しい地域の追加
- 出力フォーマットの変更
- 追加データ項目の取得

## 📄 ライセンス

このソフトウェアはMITライセンスの下で提供されています。

## 🏗️ アーキテクチャ

### リファクタリング版の構成

```
restaurant-scraper/
├── config/              # 設定管理
│   ├── constants.py     # 定数定義
│   ├── settings.py      # 環境設定
│   └── logging_config.py # ロギング設定
├── scrapers/            # スクレイパー実装
│   ├── base.py          # 基底スクレイパークラス
│   └── async_scraper.py # 非同期スクレイパー
├── utils/               # ユーティリティ
│   ├── validators.py    # データバリデーション
│   ├── error_handler.py # エラーハンドリング
│   └── progress.py      # 進捗管理
└── tests/               # テストコード

```

詳細は[アーキテクチャドキュメント](docs/architecture.md)、[APIリファレンス](docs/api-reference.md)、[移行ガイド](docs/migration-guide.md)を参照してください。

## 🔄 更新履歴

### v2.0.0 (2025-07-31)
- 大規模リファクタリング実施
- モジュール構造の改善
- 型ヒントとバリデーション強化
- 包括的なテストスイート追加
- ドキュメントの整理と改善

### v1.2.0 (2025-07-31)
- 高速非同期版の実装（10倍速）
- ジャンル抽出バグの修正
- 進捗の永続化機能追加
- エラーハンドリングの改善

### v1.0.0 (2025-07-31)
- 初回リリース
- 食べログスクレイピング機能
- ホットペッパーAPI連携
- Excel出力機能
- 対話モード実装

---

**注意**: このアプリケーションは営業活動支援を目的としており、各サービスの利用規約を遵守して使用してください。

