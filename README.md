# Restaurant Scraper - 飲食店営業リスト作成アプリ

食べログ・ホットペッパーグルメから飲食店情報を収集してExcelファイルに出力するPythonスクレイパー（リファクタリング版）

## 🎯 機能

- **食べログスクレイピング**: 店名・電話番号・住所・ジャンル・最寄り駅・営業時間・席数・口コミ数を取得
- **ホットペッパーAPI**: 公式APIを使用した高速・安全なデータ取得
- **高速非同期処理**: 最大10同時接続で効率的な処理
- **データソース統合**: 両方のソースから取得して重複を自動除去
- **データ統合**: 重複除去・データ品質チェック・正規化
- **Excel出力**: 見やすいフォーマットでの営業リスト作成
- **対話モード**: 非エンジニア向けの簡単操作
- **進捗の永続化**: 中断から再開可能な堅牢な設計
- **エラーハンドリング**: 自動リトライとエラー統計

## 📋 必要な環境

- Python 3.8以上
- インターネット接続
- ホットペッパーAPIキー（オプション）

## 🚀 インストール

### 1. ファイルのダウンロード

以下のファイルを同じフォルダに保存してください：

```
restaurant_scraper_app.py
hotpepper_api_client.py
tabelog_scraper_improved.py
restaurant_data_integrator.py
requirements.txt
setup.py
README.md
```

### 2. セットアップ実行

```bash
python setup.py
```

## 💡 使用方法

### 基本的な使い方

```bash
# 食べログから渋谷エリアの飲食店100件を取得
python main.py --areas 渋谷 --limit 100

# 複数エリアから取得
python main.py --areas "銀座・新橋・有楽町" "新宿・代々木・大久保" --limit 200

# ホットペッパーから取得（APIキーが必要）
python main.py --source hotpepper --areas 東京都 --hotpepper-key YOUR_API_KEY --limit 100

# 両方のソースから取得して統合
python main.py --source both --areas 渋谷 --hotpepper-key YOUR_API_KEY --limit 200
```

### 詳細オプション

```bash
# キーワード検索（ホットペッパー）
python main.py --source hotpepper --areas 東京都 --keyword 居酒屋 --hotpepper-key YOUR_API_KEY

# 同時接続数と遅延時間の調整
python main.py --areas 渋谷 --concurrent 20 --delay-min 0.5 --delay-max 2.0

# Excel出力なしでJSONのみ保存
python main.py --areas 渋谷 --no-excel

# カスタム出力ファイル名
python main.py --areas 渋谷 --output shibuya_restaurants
```

### エリア指定の例

**食べログのエリア名（具体的なエリア）**
- `渋谷`
- `銀座・新橋・有楽町`
- `新宿・代々木・大久保`
- `池袋～高田馬場・早稲田`
- `東京・丸の内・日本橋`

**ホットペッパーのエリア名（都道府県または大エリア）**
- `東京都`
- `大阪府`
- `神奈川県`

### 環境変数による設定

```bash
# ホットペッパーAPIキーを環境変数で設定
export HOTPEPPER_API_KEY="YOUR_API_KEY"
python main.py --source hotpepper --areas 東京都

# その他の環境変数
export MAX_CONCURRENT=50        # 最大同時接続数
export DELAY_MIN=0.5           # 最小遅延秒数
export DELAY_MAX=2.0           # 最大遅延秒数
export LOG_LEVEL=DEBUG         # ログレベル
```

## 🔑 ホットペッパーAPIキーの取得

1. [リクルートWEBサービス](https://webservice.recruit.co.jp/)にアクセス
2. 無料会員登録
3. ホットペッパーグルメサーチAPIのAPIキーを取得

## 📊 出力ファイル

### Excelファイル構成

**飲食店リストシート**
- 店名: 店舗名
- 電話番号: 連絡先電話番号
- 住所: 店舗住所
- ジャンル: 料理ジャンル
- 最寄り駅: アクセス情報
- 営業時間: 営業時間・定休日
- 席数: 座席数（食べログのみ）
- 公式URL: 公式サイト（食べログのみ）
- 口コミ数: レビュー件数（食べログのみ）
- 評価: 評価点（食べログのみ）
- 予算（夜）: ディナー予算
- 予算（昼）: ランチ予算（食べログのみ）
- URL: 店舗詳細ページURL
- データソース: 食べログ/ホットペッパーグルメ
- 取得日時: データ取得日時

**サマリーシート**
- 総件数
- 電話番号あり件数
- 住所あり件数
- データソース別件数
- 作成日時

## 🎛️ コマンドラインオプション

```bash
--areas AREAS [AREAS ...]     # 対象エリア（複数指定可）
--limit LIMIT                 # 取得する最大件数（デフォルト: 100）
--pages PAGES                 # エリアごとの最大ページ数（デフォルト: 10）
--concurrent CONCURRENT       # 最大同時接続数（デフォルト: 10）
--delay-min DELAY_MIN        # 最小遅延秒数（デフォルト: 1.0）
--delay-max DELAY_MAX        # 最大遅延秒数（デフォルト: 3.0）
--source {tabelog,hotpepper,both}  # データソース（デフォルト: tabelog）
--hotpepper-key KEY          # ホットペッパーAPIキー
--keyword KEYWORD            # 検索キーワード（ホットペッパー用）
--output OUTPUT              # 出力ファイル名（拡張子なし）
--no-excel                   # Excel出力をスキップ
--config CONFIG              # 設定ファイルのパス
--debug                      # デバッグモードを有効化
--help, -h                   # ヘルプ表示
```

## 🌍 対応地域

- 東京都
- 大阪府
- 神奈川県
- 愛知県
- 福岡県
- 北海道
- 京都府
- 兵庫県
- 埼玉県
- 千葉県

## ⚠️ 注意事項

### 利用規約の遵守

- **食べログ**: 過度なアクセスを避け、サーバーに負荷をかけないよう配慮
- **ホットペッパー**: 公式APIの利用規約に従って使用
- **商用利用**: 各サービスの利用規約を確認してください

### レート制限

- 食べログ: 2-4秒間隔でアクセス
- ホットペッパー: API制限に準拠

### データ品質

- 店舗情報は取得時点のものです
- 営業時間や電話番号は変更される可能性があります
- 営業前に最新情報を確認することをお勧めします

## 🔧 トラブルシューティング

### よくある問題

**1. パッケージインストールエラー**
```bash
pip install --upgrade pip
python setup.py
```

**2. 食べログからデータが取得できない**
- インターネット接続を確認
- しばらく時間をおいて再実行

**3. ホットペッパーAPIエラー**
- APIキーが正しいか確認
- API利用制限に達していないか確認

**4. Excelファイルが開けない**
- ファイルが他のアプリで開かれていないか確認
- 十分な空き容量があるか確認

### ログファイル

実行時のログは `restaurant_scraper.log` に保存されます。
エラーが発生した場合は、このファイルを確認してください。

## 📈 パフォーマンス

### 取得速度の目安

- 食べログ: 約3-5秒/件
- ホットペッパー: 約0.1秒/件（API）

### 推奨設定

- 小規模テスト: 10-50件/地域
- 本格運用: 100-500件/地域
- 大規模調査: 1000件以上/地域

## 🤝 サポート

### 技術的な質問

1. ログファイル（restaurant_scraper.log）を確認
2. エラーメッセージを記録
3. 実行環境（OS、Pythonバージョン）を確認

### 機能改善要望

- 新しい地域の追加
- 出力フォーマットの変更
- 追加データ項目の取得

## 📄 ライセンス

このソフトウェアはMITライセンスの下で提供されています。

## 🏗️ プロジェクト構成

```
restaurant-scraper/
├── src/                    # ソースコード
│   ├── config/            # 設定管理
│   │   ├── __init__.py
│   │   ├── constants.py   # 定数定義
│   │   └── settings.py    # 環境設定
│   ├── extractors/        # データ抽出
│   │   ├── __init__.py
│   │   ├── base.py        # 基底抽出クラス
│   │   └── tabelog.py     # 食べログ抽出ロジック
│   ├── scrapers/          # スクレイパー実装
│   │   ├── __init__.py
│   │   ├── base.py        # 基底スクレイパー
│   │   ├── tabelog.py     # 食べログスクレイパー
│   │   └── hotpepper.py   # ホットペッパースクレイパー
│   └── utils/             # ユーティリティ
│       ├── __init__.py
│       └── validators.py  # データバリデーション
├── tests/                 # テストコード
├── cache/                 # キャッシュディレクトリ
├── output/                # 出力ディレクトリ
├── logs/                  # ログディレクトリ
├── archived_versions/     # 旧バージョンアーカイブ
├── main.py               # メインエントリーポイント
├── restaurant_data_integrator.py  # データ統合
├── hotpepper_api_client.py       # ホットペッパーAPIクライアント
├── requirements.txt      # 依存パッケージ
├── setup.py             # セットアップスクリプト
└── README.md            # このファイル
```

## 🔄 更新履歴

### v3.0.0 (2025-08-05)
- ホットペッパーグルメ統合実装
- データソース選択機能（食べログ/ホットペッパー/両方）
- 重複データ自動除去機能
- コマンドラインインターフェース刷新
- プロジェクト構造の再編成

### v2.1.0 (2025-08-04)
- 口コミ数取得の修正
- 席数・公式URL取得機能追加
- データ品質統計の改善

### v2.0.0 (2025-08-04)
- 大規模リファクタリング実施
- モジュール構造の改善
- 非同期処理による高速化（10倍）
- 進捗の永続化機能追加

### v1.0.0 (2025-08-03)
- 初回リリース
- 食べログスクレイピング機能
- Excel出力機能

---

**注意**: このアプリケーションは営業活動支援を目的としており、各サービスの利用規約を遵守して使用してください。

