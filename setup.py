#!/usr/bin/env python3
# -*- coding: utf-8 -*-

"""
é£²é£Ÿåº—å–¶æ¥­ãƒªã‚¹ãƒˆä½œæˆã‚¢ãƒ—ãƒª ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
"""

import subprocess
import sys
import os

def install_requirements():
    """å¿…è¦ãªãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«"""
    print("ğŸ“¦ å¿…è¦ãªãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ä¸­...")
    
    try:
        subprocess.check_call([
            sys.executable, "-m", "pip", "install", "-r", "requirements.txt"
        ])
        print("âœ… ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãŒå®Œäº†ã—ã¾ã—ãŸ")
        return True
    except subprocess.CalledProcessError as e:
        print(f"âŒ ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã«å¤±æ•—ã—ã¾ã—ãŸ: {e}")
        return False

def test_installation():
    """ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã‚’ãƒ†ã‚¹ãƒˆ"""
    print("ğŸ§ª ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã‚’ãƒ†ã‚¹ãƒˆä¸­...")
    
    try:
        # å¿…è¦ãªãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®ã‚¤ãƒ³ãƒãƒ¼ãƒˆãƒ†ã‚¹ãƒˆ
        import requests
        import bs4
        import pandas
        import openpyxl
        import lxml
        
        print("âœ… å…¨ã¦ã®å¿…è¦ãªãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãŒæ­£å¸¸ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã¾ã™")
        
        # ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®åŸºæœ¬ãƒ†ã‚¹ãƒˆ
        from restaurant_data_integrator import RestaurantDataIntegrator
        integrator = RestaurantDataIntegrator()
        print("âœ… ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®åŸºæœ¬æ©Ÿèƒ½ãŒæ­£å¸¸ã«å‹•ä½œã—ã¾ã™")
        
        return True
        
    except ImportError as e:
        print(f"âŒ ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ã‚¤ãƒ³ãƒãƒ¼ãƒˆã«å¤±æ•—ã—ã¾ã—ãŸ: {e}")
        return False
    except Exception as e:
        print(f"âŒ ãƒ†ã‚¹ãƒˆã«å¤±æ•—ã—ã¾ã—ãŸ: {e}")
        return False

def main():
    """ãƒ¡ã‚¤ãƒ³é–¢æ•°"""
    print("ğŸ½ï¸ é£²é£Ÿåº—å–¶æ¥­ãƒªã‚¹ãƒˆä½œæˆã‚¢ãƒ—ãƒª ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—")
    print("=" * 50)
    
    # ç¾åœ¨ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ç¢ºèª
    current_dir = os.getcwd()
    print(f"ç¾åœ¨ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª: {current_dir}")
    
    # requirements.txtã®å­˜åœ¨ç¢ºèª
    if not os.path.exists("requirements.txt"):
        print("âŒ requirements.txtãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“")
        return False
    
    # ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
    if not install_requirements():
        return False
    
    # ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãƒ†ã‚¹ãƒˆ
    if not test_installation():
        return False
    
    print("\nğŸ‰ ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ãŒå®Œäº†ã—ã¾ã—ãŸï¼")
    print("\nä½¿ç”¨æ–¹æ³•:")
    print("  å¯¾è©±ãƒ¢ãƒ¼ãƒ‰: python restaurant_scraper_app.py -i")
    print("  ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³: python restaurant_scraper_app.py --areas æ±äº¬éƒ½ --max-per-area 100")
    print("\nè©³ç´°ãªãƒ˜ãƒ«ãƒ—: python restaurant_scraper_app.py --help")
    
    return True

if __name__ == "__main__":
    success = main()
    sys.exit(0 if success else 1)

